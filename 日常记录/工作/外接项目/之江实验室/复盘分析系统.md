---
author: "fmw666"
date: 2023-08-28 19:26:00
tags: ["工作", "开发"]
---

# 复盘分析系统

### 

1. role based 登录、管理

前端是 vue，用 token 验证。
后端用 flask，现在用 flask-jwt-extended 做好了单一权限的用户注册、登录、编辑
一个数据库，9个表，要写一些增删查改。现在目前表建好了，业务已经写了一部分吧，我还没具体review另一个后端小姐姐的代码。用的 Flask-SQLAlchemy

主要需求是算法团队做实验，我们把实验数据的“路径”，实验结果的“路径”存到数据库里；然后再存一些实验中发生的问题，实验结论。为了方便以后查看。

现在团队有两个前端，两个外行临时来做后端 = =

出海后得到一些数据，在返航后分析数据

### 问题？

1. 增删改查需求
1. 用户权限、用户身份表的额外设计 <演示文稿0809.pptx> P49.
1. 表数据在前端的展示（查找、过滤、返回结构）涉及到大量额外查询接口. <演示文稿0809.pptx> P8.
1. 图片下载、数据下载、生成文件等额外业务功能接口. <演示文稿0809.pptx> P23.


您好，看完那些资料后我有几个问题想确认下：

1. 关于 <计划安排.pdf> 中，虽然您说让我不用管这个时间，但是我想确认的是最终交付是按照 <计划安排.pdf> 中 "第二个里程碑" 为准吗？
1. 实验管理界面设计一些额外的表结构设计（包括权限、角色）、数据下载上传、前端特定格式展示
1. 实验分析界面涉及大量额外查询接口、图片下载、数据下载、文件生成的业务。

1. 演示文稿中的内容是团队自己做的还是需求方给的？
1. 实现效果的预期有吗？
1. 大家额外开发时间有多少？

## 设计

实验管理界面、部分实验分析界面（大概 10 个？）

后端进行登录界面功能开发、实验管理功能开发；matlab 多线程调用分析功能开发；与前端交互接口 API 设计；数据库增删查改接口开发；编写单元测试用例

前后端对接 API 接口，联调功能与界面

后端按一阶段的完成情况和客户反馈，进行一阶段界面功能改进、问题修复；补充未完成的分析界面的算法调度、参数调整功能以及数据库的操作优化、组合查询功修改改进；开发权限管理功能，对用户、角色进行数据库建设和功能管理；开发过程与前端联调；

### 为什么不用 flask swagger-ui 而是用其他在线 api 文档工具

1. 变量管理
1. 认证访问

### 为什么需要测试用例？

1. 验证功能：测试用例可以确保你的代码实现了预期的功能，从而提高用户满意度。
1. Bug 检测和修复：即使是小项目，也可能存在潜在的错误。测试用例可以帮助你及早发现和修复 bug，防止在生产环境中出现问题。
1. 代码稳定性：测试用例可以确保项目在修改和扩展代码时不会产生意外的副作用，从而保持代码的稳定性。
1. 项目可维护性：测试用例可以作为文档，帮助你和其他开发者理解代码的预期行为和功能。当你回顾项目或其他开发者接手项目时，测试用例能提供清晰的指导。
1. 持续集成和部署：在持续集成和部署流程中，自动化测试可以帮助你快速发现问题，从而确保每次部署都是可靠的。
1. 防止回归问题：当你修改代码时，测试用例可以防止已经修复的问题再次出现，避免回归问题。
1. 节省时间和资源：尽早发现和修复问题可以避免将问题推迟到项目后期，节省时间和资源。
1. 提高开发速度： 测试用例可以让你更自信地重构和扩展代码，从而提高开发速度。

### 表

1. 任务信息表：t_task_info
1. 舰艇信息表：t_ship_info
1. 阵信息表：t_array_info
1. 上报事件表：t_event_info
1. 航路信息表：t_route_info
1. 数据存储路径表（包含阵的原始数据、音视频数据等各类以文件形式存储的数据）：t_datapath_info
1. 实验信息表：t_experiment_info
1. 分析结果表：t_experiment_analysis
1. 实验结论表：t_experiment_conclusion

一个任务对应对个舰艇，一个舰艇对应多个阵

## TODO

+ [ ] 0829 创建 接口文档
+ [ ] 0830 根据阶段性任务补充对应需求的接口（请求方法，请求路径，请求体）
+ [ ] 将 sqlite 改为 mysql（交付前）
+ [x] 确认 api 设计
+ [ ] 0831 创建表，并添加 app，完善部分接口
+ [ ] 前端人员在页面开发中随时补充测试用例文档
+ [ ] 前端人员如果需要接口支持，补充在文档里，比如获取算法列表接口
+ [ ] 接口路由划分及定义
+ [ ] sqlalchemy model 定义和表设计文档不符，外键写在哪个里面？（我推荐 model 定义那样实现）
    model 定义版本：

    ```
    Task: id, name, ships(by framework)
    Ship: id, name, task_id

    一个 Task 包含多个 Ship
    Task: 1, t1
          2, t2
    
    Ship: 1, s1, 1
          2, s2, 1
    
    总结：1对n，n那个模型去定义外键，这样可以通过1直接查到n
    ```

    文档定义版本：

    ```
    Task: id, name, ship_id
    Ship: id, name

    一个 Task 包含多个 Ship
    Task: 1, t1, 10
          1, t1, 11
    
    Ship: 10, s10
          11, s11

## 需求拆分

【安排】

每阶段的安排大致如下：

1. 整理接口文档并完善
2. 制定接口测试用例并完善
3. 完成接口功能开发
4. 构建数据并做前后端联调
5. 根据测试用例结果修改 bug 或补充文档

===

【举例】

以第一阶段 9.3 前 [v0.1.5 完整时域波形分析] 任务为例：
8.30前完成(1day)：关于 1,2 今晚我会整理好 接口文档 和 接口测试 用例大纲，大家明天根据开发需求补充完整. @前后端人员一起
9.1前完成(2day)：针对接口文档，前端做页面，后端做接口.
9.2前完成(1day)：前后端联调，后端负责将测试数据构建好存入 sqlite，前端（或其他测试）人员运行前后端环境按测试用例进行测试.
9.3前完成(1day)：根据测试用例结果修改 bug 或补充遗漏接口.

===

【说明】

接口文档：明确有哪些接口要实现，这些接口功能是什么？是否需要身份认证？请求方法是什么？请求路径是什么？请求体是什么？正确/错误的响应结构是什么？
测试用例：用户所有的操作路径、边界情况、错误处理、（性能、安全）... 测试是否符合预期范围

### 登录页面

+ 登录接口
    + POST `/api/authentication/login`
    + {"username": "admin", "password": "admin"}

===

附加功能：

1. 删除系统

    + 立即删除，但有回收站系统
    + 删除前的丰富确认（哪些能立即删除，哪些有删除前的前置约束）

1. 插件系统

    + 用户可以自定义插件

1. 队列形式的实验分析

    + 嗯... 那如果是这样，系统可以这样设计，开始分析实验，前端也不用转圈圈等待，直接告诉用户，实验正在分析。然后把实验分析进度放到（比如页面下方的）任务队列中。每当任务队列中一个分析任务完成，页面右上角给个提示，“xxx 实验已分析完成...”，用户可以点击直接跳转到该页面查看该次分析结果。或者可以手动进入对应页面，通过查看历史分析记录，获取该次的实验结果。这样用户就可以先进入实验1，选好参数开始分析，然后进入实验2，选好参数开始分析（或某个实验选不同参数进行多次分析）。最后再把任务队列打开，实时查看各任务分析进度，也可以取消某次分析。

1. 缓存系统

    + 缓存实验结果数据
